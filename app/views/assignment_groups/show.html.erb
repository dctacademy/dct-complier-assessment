<div class="row">
	<%= render 'breadcrum' %>

<div class="col-md-8">
	<div class="page-header">
		<h2><%= @assignment_group.title %>
		 	</h2>
	</div>

<div class="alert alert-info" role="alert">Assignments in this group is due on <%= @assignment_group.due_datetime.strftime("%d, %b %Y %H:%M %p") %>
  <span class="pull-right"> 
    <span id="display">time remaining </span>
  </span>

</div>

<table id="myTable" class="table table-striped">
  <thead>
    <tr>
      <th>Title</th>
      <th>Code</th>
      <th>Body</th>
      <th>Tags</th>
      <th>Actions</th>
    </tr>
  </thead>

  <tbody>
    <% @assignment_group.practices.each do |practice| %>
      <tr>
        <td><%= practice.assignment.title %></td>
        <td><%= practice.assignment.code %></td>
        <td><%= raw (practice.assignment.body).truncate(75) %></td>
        <td><%= practice.assignment.tag_list %></td>
        <td><%= link_to 'Solve', practice %>

          <% if current_user %>
  					<% if can? :destroy, practice %>
              <%= link_to 'Destroy', practice, method: :delete, data: { confirm: 'Are you sure?' } %>
							<%= link_to "submissions" , practice_submissions_path(practice) %>
                
              </td>
						<% end %>
        <% end %>
      </tr>
    <% end %>
  </tbody>
</table>

<% if can? :update, @assignment_group %>
	<%= link_to 'Edit', edit_batch_assignment_group_path(params[:batch_id],@assignment_group) %> |
<% end %>
<%= link_to 'Back', batch_path(params[:batch_id]) %>

</div>

<div class="col-md-4">
	<div class="page-header">
		<h2>Assigned to</h2>
	</div>
    <ul class="list-group">
    <% @assignment_group.students.each do |student| %>
      <li class="list-group-item">
        <% if current_user.role? "admin" %>
          <%= link_to student.name %>
          <%#= link_to student.name, batch_assignment_groups_student_solutions_path(@batch.id, assignment_group_id: @assignment_group.id, student_user_id: student.user.id) %>
        <% else %>
          <%= student.name %>
        <% end %>
      </li>
    <% end %>
    </ul>
</div>

<script>
    var currentDate = new Date();
    var dueDateTime = new Date('<%= @assignment_group.due_datetime.year %>', '<%= @assignment_group.due_datetime.month - 1 %>', '<%= @assignment_group.due_datetime.day %>', '<%= @assignment_group.due_datetime.hour %>', '<%= @assignment_group.due_datetime.min %>');

    var count = Math.round((Number(dueDateTime) - Number(currentDate))/1000);
    var timerRef;

    function prepend(n){
      return (n <= 9) ? `0${n}` : n;
    }

    function formatTime(count){
      var days = Math.floor(count/86400);
      var hours = Math.floor((count % 86400) / 3600);
      var minutes = Math.floor(((count % 86400) % 3600)/60)
      var seconds = Math.floor((count % 86400) % 3600) % 60;

      return ` time remaining ${prepend(days)} : ${prepend(hours)} : ${prepend(minutes)} : ${prepend(seconds)}`;
    }

    if(count > 0){
       timerRef = setInterval(function(){
          document.querySelector('#display').innerHTML = formatTime(count);
          count--;
          if(count < 0){
            clearInterval(timerRef);
            document.querySelector('#display').innerHTML = "<strong> time up</strong>";
          }
        },1000);
     } else {
        document.querySelector('#display').innerHTML = "<strong> time up</strong>";
     }
   

</script>